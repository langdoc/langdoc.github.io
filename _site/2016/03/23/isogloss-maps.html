<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Isogloss maps with Shapefiles</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://langdoc.github.io/2016/03/23/isogloss-maps.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Language Documentation</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

<a href="https://github.com/langdoc"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/categories.html">Categories</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/search/">Search</a>
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">

  <header class="post-header">
    <h1 class="post-title">Isogloss maps with Shapefiles</h1>
    <p class="post-meta">Mar 23, 2016 • Niko Partanen</p>
  </header>

  <article class="post-content">
    <p>I’ve been working lately a lot with language areas as different Shapefiles. This works nicely, and usually it is quite unproblematic to make a functional map. There are some problems I haven’t solved, mainly with the best way to store different attributes relevant for languages, but which I wouldn’t like to store repeatingly inside the Shapefile. But now I tackle a bit different issue, which is the use of Shapefiles to mark isoglosses. As usually, I don’t want to take the easiest route, but would look for something efficient, economic, pretty and easy to manage. <!--more--></p>

<p>Let’s take a look into a Shapefile, or Geojson, whatever. When the data is read to R as <code>SpatialPolygonsDataFrame</code> it behaves the same way whatever the origin. It is bit more complex format which has slots for different kinds of information. The most important ones are <code>@data</code> and <code>@polygons</code>. The first is just a data frame, and it can be accessed with <code>object@data$column</code>. It is possible to do there quite many of those things which you would do with any other data frame, which makes it very powerful tool.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span>

<span class="c1"># Here we read in the polygons - now in geojson, but the original format is not that relevant
</span>
<span class="n">kpv</span> <span class="o">&lt;-</span> <span class="n">readOGR</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/nikopartanen/language_maps/master/geojson/kpv.geojson"</span><span class="p">,</span> <span class="s2">"OGRGeoJSON"</span><span class="p">)</span>
<span class="n">koi</span> <span class="o">&lt;-</span> <span class="n">readOGR</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/nikopartanen/language_maps/master/geojson/koi.geojson"</span><span class="p">,</span> <span class="s2">"OGRGeoJSON"</span><span class="p">)</span>
<span class="n">jzv</span> <span class="o">&lt;-</span> <span class="n">readOGR</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/nikopartanen/language_maps/master/geojson/koi-j.geojson"</span><span class="p">,</span> <span class="s2">"OGRGeoJSON"</span><span class="p">)</span>

<span class="c1"># Those polygons are added as new layers to the Leaflet map
</span>
<span class="n">map</span> <span class="o">&lt;-</span> <span class="n">leaflet</span><span class="p">()</span> <span class="o">%&gt;%</span>
              <span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"Esri.WorldTopoMap"</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">kpv</span><span class="p">,</span>
              <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> 
              <span class="n">weight</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">popup</span> <span class="o">=</span> <span class="o">~</span><span class="n">dial</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">koi</span><span class="p">,</span>
              <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> 
              <span class="n">weight</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">popup</span> <span class="o">=</span> <span class="o">~</span><span class="n">dial</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">jzv</span><span class="p">,</span>
              <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> 
              <span class="n">weight</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">popup</span> <span class="o">=</span> <span class="o">~</span><span class="n">dial</span><span class="p">)</span></code></pre></figure>

<iframe width="100%" height="500" src="http://nikopartanen.github.io/language_maps/webmap/komi_basic.html"></iframe>

<p>Now there are of course lots of different isoglosses, but they don’t necessarily align by dialects. So we cannot just store information with what kind of isogloss value which polygon is associated. In a way where this line goes can be rather arbitrary, although it is also absolute in the sense that at least on more abstract level we can say this line goes along the line. It is always another question how the isoglosses pattern in our actual corpus data. But I think both representations have their own value and use.</p>

<p>This is a good example which cuts across all main variants, showing the variation in stress within Komi. It is taken from Batalova’s 1982 book <strong>Ареальные исследования по восточным финно-угорским языкам (коми языки)</strong>, page 41.</p>

<p><img src="/media/figures/batalova1982a-41.png" alt="stress in Komi" /></p>

<p>To explain it simply, the majority of Komi-Zyrian has no morphologically significant stress, but in some southern dialects this feature is present, as it is in almost all Komi-Permyak, besides small eastern region where the stress is connected to vowel system more widely, as it is in all Komi-Yazva. In this case almost all action is in the southern varieties, so I’ll try to display it so that the attention is more theere (and some southern varieties are geographically very small, which makes them difficult to show on large scale maps).</p>

<p>We could take the polygons above and modify a variant which is cut according to this pattern, but this has some problems as well. Mainly that the changes in original polygons would not be reflected in the Shapefiles which contain the isoglosses! This would have fast quite disastrous results, and generally speaking would not be very elegant.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span>

<span class="c1"># This is same as above, but the polygon is read from Shapefile
</span>
<span class="n">isogloss</span> <span class="o">&lt;-</span> <span class="n">readShapePoly</span><span class="p">(</span><span class="s2">"/Volumes/langdoc/maps/language_maps/isoglosses/kom.shp"</span><span class="p">,</span> <span class="n">proj4string</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="p">))</span>

<span class="n">map</span> <span class="o">%&gt;%</span> <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">isogloss</span><span class="p">,</span>
              <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> 
              <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> 
              <span class="n">weight</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
              <span class="n">popup</span> <span class="o">=</span> <span class="o">~</span><span class="n">value</span><span class="p">)</span></code></pre></figure>

<iframe width="100%" height="500" src="http://nikopartanen.github.io/language_maps/webmap/komi_isogloss_blobs.html"></iframe>

<p>This is maybe a bit strange approach. But in many ways it is the best I’ve come up with. We can use this command from GDAL to clip the isogloss polygon with the areas defined in the language polygon.</p>

<pre><code>ogr2ogr -clipsrc langs/kom/kom.shp isoglosses/kom_isogloss_1_cut.shp isoglosses/kom_isogloss.shp
</code></pre>

<p>This gives us something we can easily use elsewhere on maps. It will look as good as the language polygons do, but we can associate any kind of overlays with it and still be rather sure things are not breaking apart. The isogloss shapefiles will not need special maintenance work when the language polygons are modified, and this is something really important if the idea is to have something more reliable than just graphics used once and forgotten.</p>

<p>It can be bit annoying ot modify Shapefiles like these, so take a look into snapping options in QGIS to make this bit easier. Otherwise it would be next to impossible to get the polygons align prettily, and I think it is quite crucial there are no holes between the polygons.</p>

<p>There is nothing really new going on in the map below, but note that we are using <code>RColorBrewer</code> package to set up the color scheme. The colors are always little bit complicated. On one hand they should just appear automatically and be nice, but that doesn’t work so well with varying number of features, and at times some combinations just don’t work and you want to touch them manually. However, something with <code>RColorBrewer</code> should be simple enough to have inside a function which tries to select suitable color palette for most of the cases. And if there would be tens of different values to map, it probably would not be always that good idea to place them all on one map to start with.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span>

<span class="n">isogloss_cut</span> <span class="o">&lt;-</span> <span class="n">readShapePoly</span><span class="p">(</span><span class="s2">"/Volumes/langdoc/maps/language_maps/isoglosses/kom_isogloss_1_cut.shp"</span><span class="p">,</span> <span class="n">proj4string</span> <span class="o">=</span> <span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="p">))</span>

<span class="c1"># Here we need to play around a bit to get the values and colors correctly both on map and in legend.
# There maybe is some better way to do it, but this is how I've done it now.
</span>
<span class="n">value</span> <span class="o">&lt;-</span> <span class="n">as.character</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">isogloss_cut</span><span class="o">@</span><span class="n">data</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">arrange</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">.</span><span class="o">$</span><span class="n">value</span><span class="p">)</span> 
<span class="n">colors</span> <span class="o">&lt;-</span> <span class="n">RColorBrewer</span><span class="o">::</span><span class="n">brewer.pal</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="s2">"Dark2"</span><span class="p">)</span>

<span class="n">leaflet</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="n">setView</span><span class="p">(</span><span class="n">lng</span> <span class="o">=</span> <span class="m">54</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="m">60</span><span class="p">,</span> <span class="n">zoom</span> <span class="o">=</span> <span class="m">6</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"Esri.WorldTopoMap"</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">isogloss_cut</span><span class="p">,</span>
              <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">fillColor</span> <span class="o">=</span> <span class="o">~</span><span class="n">colors</span><span class="p">,</span>
              <span class="n">weight</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">popup</span> <span class="o">=</span> <span class="o">~</span><span class="n">value</span><span class="p">,</span>
              <span class="n">stroke</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">addLegend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">"Stress in Komi Dialects"</span><span class="p">,</span>
    <span class="n">opacity</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span></code></pre></figure>

<iframe width="100%" height="500" src="http://nikopartanen.github.io/language_maps/webmap/komi_isogloss_stress.html"></iframe>

<p>I think the next topic would be how to associate points with polygons, for example, to gather data from polygon layers to the token level data frames where there are different coordinates. It could be quite interesting to locate all speakers whose bithplace and place of residence are on different isogloss areas, as just looking to the adaptation of different variables could be enlightening.</p>

    <p id="post-meta"> <i class="fa fa-tags"></i> </p>
  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">
        <figure>
              <center><img src="/media/logo/kone_logo_web.png" width="400px"></center>
        </figure>
    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:barentsdoc@gmail.com">barentsdoc@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/langdoc">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">langdoc</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/nikopartanen">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">nikopartanen</span>
            </a>
          </li>
          
        </ul>
      </div>
      <div class="footer-col  footer-col-3">
        <p class="text" style="font-size:80%">  This website has been done in within <a href="http://www.koneensaatio.fi/en/">Kone Foundation</a> funded research project Izhva Komi Language Documentation. The project is led by <a href="mailto:rogier.blokland@moderna.uu.se">Rogier Blokland, <a href="mailto:m.riessler@gmail.com">Michael Rießler</a> and <a href="mailto:fedinamarina@gmail.com">Marina Fedina</a>.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
